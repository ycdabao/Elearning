!function($){$.pdialog={_op:{height:300,width:580,minH:40,minW:50,total:20,max:!1,mask:!1,resizable:!0,drawable:!0,maxable:!0,minable:!0,fresh:!0,iframe:!1,fullH:!1,enddrag:!1},_openop:{},_current:null,_zIndex:1042,getCurrent:function(){return this._current},reload:function(a,b){var c=$.extend({data:{},dialogId:"",callback:null},b),d=c.dialogId&&$("body").data(c.dialogId)||this._current;if(d){var e=d.find(".dialogContent");e.ajaxUrl({type:"POST",url:a,data:c.data,callback:function(a){e.find("[layoutH]").layoutH(e),$(".pageContent",d).width($(d).width()-14),$(":button.close",d).click(function(){return $.pdialog.close(d),!1}),$.isFunction(c.callback)&&c.callback(a)}})}},open:function(a,b,c,d){var e=$.extend({},$.pdialog._op,d);void 0!=d.fullH&&($.pdialog._op.fullH=d.fullH),$.pdialog._openop=d;var f=$("body").data(b);if(f){if(f.is(":hidden")&&f.show(),e.fresh||a!=$(f).data("url")){f.data("url",a),f.find(".dialogHeader").find("h1").html(c),this.switchDialog(f);var g=f.find(".dialogContent");g.loadUrl(a,{},function(){g.find("[layoutH]").layoutH(g),$(".pageContent",f).width($(f).width()-14),$("button.close").click(function(){return $.pdialog.close(f),!1})})}}else{$("body").append($("#dialogTemplate").html()),f=$(">.dialog:last-child","body"),f.addClass(b+"-dialog"),f.data("id",b),f.data("url",a),d.close&&f.data("close",d.close),d.param&&f.data("param",d.param),$.fn.bgiframe&&f.bgiframe(),f.find(".dialogHeader").find("h1").html(c),$(f).css("zIndex",$.pdialog._zIndex+=2),$("div.shadow").css("zIndex",$.pdialog._zIndex-3).show(),$.pdialog._init(f,d),$(f).click(function(){$.pdialog.switchDialog(f)}),e.resizable&&f.jresize(),e.drawable&&f.dialogDrag(),$("a.dialogClose",f).click(function(a){return $.pdialog.close(f,d),!1}),e.maxable?$("a.maximize",f).show().click(function(a){return $.pdialog.switchDialog(f),$.pdialog.maxsize(f),f.jresize("destroy").dialogDrag("destroy"),!1}):$("a.maximize",f).hide(),$("a.restore",f).click(function(a){return $.pdialog.restore(f),f.jresize().dialogDrag(),!1}),e.minable?$("a.minimize",f).show().click(function(a){return $.pdialog.minimize(f),!1}):$("a.minimize",f).hide(),$("div.dialogHeader a",f).mousedown(function(){return!1}),$("div.dialogHeader",f).dblclick(function(){$("a.restore",f).is(":hidden")?$("a.maximize",f).trigger("click"):$("a.restore",f).trigger("click")}),e.max&&($.pdialog.maxsize(f),f.jresize("destroy").dialogDrag("destroy")),$("body").data(b,f),$.pdialog._current=f,$.pdialog.attachShadow(f);var g=$(".dialogContent",f);if(domID=/^#[a-zA-Z0-9_\-]+$/,isDomID=domID.test(a),isDomID)g.html($(a).html());else{if(e.iframe)return void g.html('<iframe src="'+a+'" width="100%" height="100%" ></iframe>');g.loadUrl(a,{},function(){g.find("[layoutH]").layoutH(g),$(".pageContent",f).width($(f).width()-14),$("button.close").click(function(){return $.pdialog.close(f),!1})})}}e.mask&&($(f).css("zIndex",1e3),$("a.minimize",f).hide(),$(f).data("mask",!0),$("#dialogBackground").show())},switchDialog:function(a){var b=$(a).css("zIndex");if($.pdialog.attachShadow(a),$.pdialog._current){var c=$($.pdialog._current).css("zIndex");$($.pdialog._current).css("zIndex",b),$(a).css("zIndex",c),$("div.shadow").css("zIndex",c-1),$.pdialog._current=a}},attachShadow:function(a){var b=$("div.shadow");b.is(":hidden")&&b.show(),b.css({top:parseInt($(a)[0].style.top)-2,left:parseInt($(a)[0].style.left)-4,height:parseInt($(a).height())+8,width:parseInt($(a).width())+8,zIndex:parseInt($(a).css("zIndex"))-1e3}),$(".shadow_c",b).children().andSelf().each(function(){$(this).css("height",$(a).outerHeight()-4)})},_init:function(a,b){var c=$.extend({},this._op,b),d=c.height>c.minH?c.height:c.minH,e=c.width>c.minW?c.width:c.minW;$(a).height(d+"px"),$(".dialogContent",a).height(d-$(".dialogHeader",a).outerHeight()-$(".dialogFooter",a).outerHeight()-6),(isNaN(a.css("width"))||a.width()<e)&&$(a).width(e+"px");var f=($(window).height()-a.height())/2;a.css({left:($(window).width()-a.width())/2,top:f>0?f:0})},initResize:function(a,b,c){$("body").css("cursor",c+"-resize"),a.css({top:$(b).css("top"),left:$(b).css("left"),height:$(b).css("height"),width:$(b).css("width")}),a.show()},repaint:function(a,b){var c=$("div.shadow");"w"!=a&&"e"!=a&&(c.css("height",c.outerHeight()+b.tmove),$(".shadow_c",c).children().andSelf().each(function(){$(this).css("height",$(this).outerHeight()+b.tmove)})),"n"!=a&&"nw"!=a&&"ne"!=a||c.css("top",b.otop-2),!b.owidth||"n"==a&&"s"==a||c.css("width",b.owidth+8),a.indexOf("w")>=0&&c.css("left",b.oleft-4)},resizeTool:function(a,b,c){$("div[class^='resizable']",c).filter(function(){return"w"==$(this).attr("tar")||"e"==$(this).attr("tar")}).each(function(){$(this).css("height",$(this).outerHeight()+b)})},resizeDialog:function(a,b,c){var d=parseInt(a.style.left),e=parseInt(a.style.top),f=parseInt(a.style.height),g=parseInt(a.style.width);if(tmove="n"==c||"nw"==c?parseInt($(b).css("top"))-e:f-parseInt($(b).css("height")),$(b).css({left:d,width:g,top:e,height:f}),$(".dialogContent",b).css("width",g+"px"),$(".pageContent",b).css("width",g-14+"px"),"w"!=c&&"e"!=c){var h=$(".dialogContent",b);h.css({height:f-$(".dialogHeader",b).outerHeight()-$(".dialogFooter",b).outerHeight()}),h.find("[layoutH]").layoutH(h),$.pdialog.resizeTool(c,tmove,b)}$.pdialog.repaint(c,{oleft:d,otop:e,tmove:tmove,owidth:g}),$(window).trigger(AjaxDo.eventType.resizeGrid)},close:function(dialog,options){"string"==typeof dialog&&(dialog=$("body").data(dialog)),void 0!==options&&"false"!=options.closecallback&&eval(options.closecallback);var close=dialog.data("close"),go=!0;if(close&&$.isFunction(close)){var param=dialog.data("param");if(param&&""!=param?(param=AjaxDo.jsonEval(param),go=close(param)):go=close(),!go)return}$(dialog).hide(),$("div.shadow").hide(),$(dialog).data("mask")&&$("#dialogBackground").hide(),$("body").removeData($(dialog).data("id")),$(dialog).trigger(AjaxDo.eventType.pageClear).remove()},closeCurrent:function(a){this.close($.pdialog._current,a)},checkTimeout:function(){var a=$(".dialogContent",$.pdialog._current),b=AjaxDo.jsonEval(a.html());b&&b.statusCode==AjaxDo.statusCode.timeout&&this.closeCurrent()},maxsize:function(a){$(a).data("original",{top:$(a).css("top"),left:$(a).css("left"),width:$(a).css("width"),height:$(a).css("height")}),$("a.maximize",a).hide(),$("a.restore",a).show();var b=$(window).width();if($.pdialog._op.fullH)var c=$(window).height();else var c=$(window).height()-34;$(a).css({top:"0px",left:"0px",width:b+"px",height:c+"px"}),$.pdialog._resizeContent(a,b,c)},restore:function(a){var b=$(a).data("original"),c=parseInt(b.width),d=parseInt(b.height);$(a).css({top:b.top,left:b.left,width:c,height:d}),$.pdialog._resizeContent(a,c,d),$("a.maximize",a).show(),$("a.restore",a).hide(),$.pdialog.attachShadow(a)},minimize:function(a){$(a).hide(),$("div.shadow").hide()},_resizeContent:function(a,b,c){var d=$(".dialogContent",a);d.css({width:b+"px",height:c-$(".dialogHeader",a).outerHeight()-$(".dialogFooter",a).outerHeight()}),d.find("[layoutH]").layoutH(d),$(".pageContent",a).css("width",b-14+"px"),$(window).trigger(AjaxDo.eventType.resizeGrid)}}}(jQuery),function(a){a.fn.extend({jresize:function(b){return"string"==typeof b&&"destroy"==b?this.each(function(){a("div[class^='resizable']",this).each(function(){a(this).hide()})}):this.each(function(){var b=a(this),c=a(".resizable");a("div[class^='resizable']",b).each(function(){var d=this;a(d).mousedown(function(e){return a.pdialog.switchDialog(b),a.resizeTool.start(c,b,e,a(d).attr("tar")),!1}).show()})})}}),a.resizeTool={start:function(b,c,d,e){a.pdialog.initResize(b,c,e),a.data(b[0],"layer-drag",{options:a.extend(a.pdialog._op,{target:e,dialog:c,stop:a.resizeTool.stop})}),a.layerdrag.start(b[0],d,a.pdialog._op)},stop:function(){var b=a.data(arguments[0],"layer-drag");a.pdialog.resizeDialog(arguments[0],b.options.dialog,b.options.target),a("body").css("cursor",""),a(arguments[0]).hide()}},a.layerdrag={start:function(b,c,d){return a.layerdrag.current||(a.layerdrag.current={el:b,oleft:parseInt(b.style.left)||0,owidth:parseInt(b.style.width)||0,otop:parseInt(b.style.top)||0,oheight:parseInt(b.style.height)||0,ox:c.pageX||c.screenX,oy:c.pageY||c.clientY},a(document).bind("mouseup",a.layerdrag.stop),a(document).bind("mousemove",a.layerdrag.drag)),a.layerdrag.preventEvent(c)},drag:function(b){if(!b)var b=window.event;var c=a.layerdrag.current,d=a.data(c.el,"layer-drag"),e=(b.pageX||b.screenX)-c.ox,f=(b.pageY||b.clientY)-c.oy;if((b.pageY||b.clientY)<=0||(b.pageY||b.clientY)>=a(window).height()-a(".dialogHeader",a(d.options.dialog)).outerHeight())return!1;var g=d.options.target,h=c.owidth,i=c.oheight;return"n"!=g&&"s"!=g&&(h+=g.indexOf("w")>=0?-e:e),h>=a.pdialog._op.minW&&(g.indexOf("w")>=0&&(c.el.style.left=c.oleft+e+"px"),"n"!=g&&"s"!=g&&(c.el.style.width=h+"px")),"w"!=g&&"e"!=g&&(i+=g.indexOf("n")>=0?-f:f),i>=a.pdialog._op.minH&&(g.indexOf("n")>=0&&(c.el.style.top=c.otop+f+"px"),"w"!=g&&"e"!=g&&(c.el.style.height=i+"px")),a.layerdrag.preventEvent(b)},stop:function(b){var c=a.layerdrag.current,d=a.data(c.el,"layer-drag");return a(document).unbind("mousemove",a.layerdrag.drag),a(document).unbind("mouseup",a.layerdrag.stop),d.options.stop&&d.options.stop.apply(c.el,[c.el]),a.layerdrag.current=null,a.layerdrag.preventEvent(b)},preventEvent:function(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1}},a.fn.dialogDrag=function(b){return"string"==typeof b&&"destroy"==b?this.each(function(){a("div.dialogHeader",this).unbind("mousedown")}):this.each(function(){var b=a(this);a("div.dialogHeader",b).mousedown(function(c){return a.pdialog.switchDialog(b),b.data("task",!0),setTimeout(function(){b.data("task")&&a.dialogDrag.start(b,c)},100),!1}).mouseup(function(a){return b.data("task",!1),!1})})},a.dialogDrag={currId:null,_init:function(b){this.currId=(new Date).getTime();var c=a("#dialogProxy");c.size()||(c=a("#dialogProxyTem").html(),a("body").append(c)),a("h1",c).html(a(".dialogHeader h1",b).text())},start:function(b,c){this._init(b);var d=a("#dialogProxy");return d.css({left:b.css("left"),top:b.css("top"),height:b.css("height"),width:b.css("width"),zIndex:parseInt(b.css("zIndex"))+1}).show(),a("div.dialogContent",d).css("height",a("div.dialogContent",b).css("height")),d.data("dialog",b),b.css({left:"-10000px",top:"-10000px"}),a(".shadow").hide(),a(d).jDrag({selector:".dialogHeader",stop:this.stop,event:c}),!1},stop:function(){var b=a(arguments[0]),c=b.data("dialog");"true"===a.pdialog._openop.enddrag&&a(document).triggerHandler("dialogDragEnd"),a(c).css({left:a(b).css("left"),top:a(b).css("top")}),a.pdialog.attachShadow(c),a(b).hide()}},a.fn.jDrag=function(b){return"string"==typeof b&&"destroy"==b?this.each(function(){a(this).unbind("mousedown",a.rwdrag.start),a.data(this,"pp-rwdrag",null)}):this.each(function(){var c=a(this);if(a.data(a.rwdrag,"pp-rwdrag",{options:a.extend({el:c,obj:c},b)}),b.event)a.rwdrag.start(b.event);else{var d=b.selector;a(d,obj).bind("mousedown",a.rwdrag.start)}})},a.rwdrag={start:function(b){document.onselectstart=function(a){return!1};var c=a.data(this,"pp-rwdrag"),d=c.options.el[0];a.data(d,"pp-rwdrag",{options:c.options}),a.rwdrag.current||(a.rwdrag.current={el:d,oleft:parseInt(d.style.left)||0,otop:parseInt(d.style.top)||0,ox:b.pageX||b.screenX,oy:b.pageY||b.screenY},a(document).bind("mouseup",a.rwdrag.stop).bind("mousemove",a.rwdrag.drag))},drag:function(b){if(!b)var b=window.event;var c=a.rwdrag.current,d=a.data(c.el,"pp-rwdrag"),e=c.oleft+(b.pageX||b.clientX)-c.ox,f=c.otop+(b.pageY||b.clientY)-c.oy;if(f<1&&(f=0),"horizontal"==d.options.move)d.options.minW&&e>=a(d.options.obj).cssv("left")+d.options.minW&&d.options.maxW&&e<=a(d.options.obj).cssv("left")+d.options.maxW?c.el.style.left=e+"px":d.options.scop&&(d.options.relObj?e-parseInt(d.options.relObj.style.left)>d.options.cellMinW&&(c.el.style.left=e+"px"):c.el.style.left=e+"px");else if("vertical"==d.options.move)c.el.style.top=f+"px";else{var g=d.options.selector?a(d.options.selector,d.options.obj):a(d.options.obj);e>=2*-g.outerWidth()/3&&f>=0&&e+g.outerWidth()/3<a(window).width()&&f+g.outerHeight()<a(window).height()&&(c.el.style.left=e+"px",c.el.style.top=f+"px")}return d.options.drag&&d.options.drag.apply(c.el,[c.el,b]),a.rwdrag.preventEvent(b)},stop:function(b){var c=a.rwdrag.current,d=a.data(c.el,"pp-rwdrag");return a(document).unbind("mousemove",a.rwdrag.drag).unbind("mouseup",a.rwdrag.stop),d.options.stop&&d.options.stop.apply(c.el,[c.el,b]),a.rwdrag.current=null,document.onselectstart=function(a){return!0},a.rwdrag.preventEvent(b)},preventEvent:function(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1}}}(jQuery);